@startuml state_machine
' State Machine Diagram reflecting the actual Streamlit app flow

[*] --> DataSelection
note right of DataSelection
  Select data source (sample, upload file, manual entry)
  Streamlit: step_data_selection()
end note

DataSelection --> DataPreview : Valid data (load/input/upload)
DataPreview --> DataSelection : Change source
note right of DataPreview
  Preview and validate data
  Streamlit: step_data_preview()
end note

DataPreview --> WeightsAdjustment : Continue
WeightsAdjustment --> DataPreview : Back
note right of WeightsAdjustment
  Adjust constraint weights and parameters
  Streamlit: step_weights_adjustment(), advanced_settings_main()
end note

WeightsAdjustment --> Scheduling : Continue
Scheduling --> WeightsAdjustment : Back
note right of Scheduling
  Run scheduling (CP-SAT + GA + SA)
  Streamlit: step_scheduling()
end note

Scheduling --> ScheduleReady : Scheduling successful
Scheduling --> Error : Scheduling failed
note right of ScheduleReady
  Show final schedule results
  Streamlit: timetable_viewer_main()
end note

Error --> DataSelection : Back to first step
note right of Error
  Validation or scheduling failed
  Shows error message and returns to first step
end note

ScheduleReady --> Exporting : Export
Exporting --> [*] : Done
note right of Exporting
  Export schedule (Excel, PDF, JSON, iCal)
  Streamlit: export buttons in timetable_viewer
end note

ScheduleReady --> DataSelection : Create new schedule

@enduml
